<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Пульт управления TTS</title>
    <style>/* Стили можно оставить те же */</style>
</head>
<body>
    <div class="container">
        <h1>Пульт управления</h1>
        <p id="status" class="disconnected">Подключение...</p>
        <label for="secret-key">Секретный ключ:</label>
        <input type="password" id="secret-key" placeholder="Введите ваш ключ">
        <label for="text-to-speak">Текст для озвучки:</label>
        <textarea id="text-to-speak" rows="4"></textarea>
        <label for="voice-select">Голос:</label>
        <select id="voice-select"><option>Загрузка голосов...</option></select>
        <button id="speak-button">Воспроизвести на стриме</button>
    </div>
    <script>
        // Здесь полный и рабочий JS для этого режима
        const statusDiv = document.getElementById('status');
        const textInput = document.getElementById('text-to-speak');
        const keyInput = document.getElementById('secret-key');
        const voiceSelect = document.getElementById('voice-select');
        const speakButton = document.getElementById('speak-button');

        // --- ЛОГИКА ЗАГРУЗКИ ГОЛОСОВ ИЗ БРАУЗЕРА ---
        function populateVoiceList() {
            const voices = window.speechSynthesis.getVoices();
            if (voices.length > 0) {
                voiceSelect.innerHTML = '';
                voices.forEach((voice) => {
                    // Показываем русские и английские голоса
                    if(voice.lang.includes('ru-') || voice.lang.includes('en-')) {
                        const option = document.createElement('option');
                        option.textContent = `${voice.name} (${voice.lang})`;
                        option.setAttribute('data-name', voice.name);
                        voiceSelect.appendChild(option);
                    }
                });
                if (voiceSelect.innerHTML === '') {
                    voiceSelect.innerHTML = '<option>Голоса не найдены</option>';
                }
            }
        }
        
        populateVoiceList();
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = populateVoiceList;
        }

        // --- ЛОГИКА WEBSOCKET И КНОПКИ ---
        const socketUrl = (location.protocol === 'https:' ? 'wss://' : 'ws://') + location.host;
        let ws;
        function connect() { /* ... код подключения WebSocket без изменений ... */ }
        connect();

        speakButton.addEventListener('click', () => {
            const text = textInput.value;
            const key = keyInput.value;
            const selectedOption = voiceSelect.selectedOptions[0];
            const voiceName = selectedOption.getAttribute('data-name');
            if (!text || !key) { alert('Введите текст и ключ'); return; }

            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({ type: 'speak', text: text, voiceName: voiceName, key: key }));
            }
        });

        // Вставьте сюда полный JS код для подключения WebSocket и кнопки из предыдущих версий
    </script>
</body>
</html>